#!/bin/bash

# Fonction de substitution
subst() {
	echo $1=$2 >> $CONFIG_DICO
}

# Fichiers intermédiaires
CONFIG_DICO=config.dico
CONFIG_SED=config.sed
echo "# Auto-generated file" > $CONFIG_DICO

# Détection de l'OS
if [ $OSTYPE = 'linux-gnu' ]; then
	subst os_name 'linux'
	subst echo_prog 'echo'
elif [ $OSTYPE = 'msys' ]; then
	subst os_name 'windows'
	subst echo_prog 'echo -e'
else
	subst os_name 'unknown'
	subst echo_prog 'echo'
fi

# Génération du makefile
sed \
	-e 's/\\/\\\\/g' \
	-e 's/\//\\\//g' \
	-e 's/\([a-zA-Z_]*\)=\(.*\)/s\/@\1@\/\2\/g/g' \
	$CONFIG_DICO > $CONFIG_SED
sed -f $CONFIG_SED Makefile.in > Makefile
